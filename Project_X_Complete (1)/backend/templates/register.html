<!-- templates/register.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register - Project X</title>
    <style>
        body { font-family: Arial, sans-serif; background: #121212; color: white; padding: 2rem; }
        .container { max-width: 400px; margin: auto; background: #1e1e1e; padding: 2rem; border-radius: 8px; }
        input, button { margin-top: 1rem; padding: 0.5rem; width: 100%; }
        a { color: #4eaaff; text-decoration: underline; display: block; margin-top: 1rem; }
    </style>
</head>
<body>
<div class="container">
    <div id="user-info"></div>

    <h2>Register</h2>
    <form id="register-form">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Register</button>
    </form>
    <div id="result"></div>

    <a href="/login">Already have an account? Login</a>
</div>

<script>
    document.getElementById('register-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);

        try {
            const response = await fetch('/register', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            const resultDiv = document.getElementById('result');

            if (response.ok) {
                resultDiv.innerHTML = `<p style="color:lightgreen;">${result.detail}</p>`;
                localStorage.setItem("username", formData.get("username"));
                setTimeout(() => {
                    window.location.href = "/login";
                }, 1500);
            } else {
                resultDiv.innerHTML = `<p style="color:red;">${result.detail}</p>`;
            }
        } catch (error) {
            alert("Registration failed: " + error.message);
        }
    });

    function logout() {
        localStorage.removeItem("username");
        location.href = "/";
    }

    window.onload = () => {
        const savedUsername = localStorage.getItem("username");
        const userInfoDiv = document.getElementById("user-info");

        if (savedUsername) {
            userInfoDiv.innerHTML = `<p>Logged in as: <strong>${savedUsername}</strong> <button onclick="logout()">Logout</button></p>`;
            // Optionally redirect to dashboard
            // window.location.href = "/";
        } else {
            document.querySelector('input[name="username"]').value = "";
        }
    };
</script>
</body>
</html>
