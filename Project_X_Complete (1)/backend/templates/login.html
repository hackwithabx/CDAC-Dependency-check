<!-- templates/login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login - Project X</title>
    <style>
        body { font-family: Arial, sans-serif; background: #121212; color: white; padding: 2rem; }
        .container { max-width: 400px; margin: auto; background: #1e1e1e; padding: 2rem; border-radius: 8px; }
        input, button { margin-top: 1rem; padding: 0.5rem; width: 100%; }
        a { color: #4eaaff; text-decoration: underline; display: block; margin-top: 1rem; }
    </style>
</head>
<body>
<div class="container">
    <h2>Login</h2>
    <form id="login-form">
        <input type="text" id="username" name="username" placeholder="Username" required>
        <input type="password" id="password" name="password" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
    <div id="result"></div>

    <a href="/register">Don't have an account? Register</a>
</div>

<script>
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        const formData = new FormData();
        formData.append("username", username);
        formData.append("password", password);

        try {
            const response = await fetch('/login', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (response.ok) {
                localStorage.setItem("username", result.username);
                localStorage.setItem("role", result.role);
                window.location.href = "/";
            } else {
                document.getElementById('result').innerHTML = `<p style="color:red;">${result.detail}</p>`;
            }
        } catch (error) {
            document.getElementById('result').innerHTML = `<p style="color:red;">Login failed: ${error.message}</p>`;
        }
    });

    window.onload = () => {
        const username = localStorage.getItem("username");
        const role = localStorage.getItem("role");

        if (username) {
            document.getElementById('username').value = username;
            const message = document.createElement("p");
            message.innerHTML = `You are already logged in as: <strong>${username}</strong> (${role})`;
            document.querySelector(".container").prepend(message);
        }
    };
</script>

</body>
</html>
